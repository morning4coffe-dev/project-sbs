<Page x:Class="ProjectSBS.Presentation.Components.ItemDetails"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:ProjectSBS.Presentation.Components"
      xmlns:models="using:ProjectSBS.Business.Models"
      xmlns:toolkit="using:CommunityToolkit.WinUI"
      xmlns:converters="using:CommunityToolkit.WinUI.Converters"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:sys="ProjectSBS:System;assembly=System.Private.CoreLib"
      xmlns:android="http://uno.ui/android"
      mc:Ignorable="d android">

    <Page.Resources>
        <Style x:Key="DetailsBorder"
               TargetType="Border">
            <Setter Property="CornerRadius"
                    Value="4" />
            <Setter Property="Background"
                    Value="{ThemeResource CardBackgroundFillColorDefault}" />
            <Setter Property="Padding"
                    Value="16" />
        </Style>

        <Style x:Key="ContentStack"
               TargetType="StackPanel">
            <Setter Property="Padding"
                    Value="12, 12" />
        </Style>

        <converters:StringFormatConverter x:Key="StringFormatConverter" />

    </Page.Resources>

    <local:PageShell MobileTitleVisibility="Visible"
                     Title="{x:Bind ViewModel.ItemName, Mode=OneWay}">
        <local:PageShell.ActionBar>

            <StackPanel Orientation="Horizontal"
                        Spacing="4"
                        Grid.Column="1">
                <Button Background="Transparent"
                        BorderBrush="Transparent"
                        BorderThickness="0"
                        Padding="12"
                        VerticalAlignment="Top"
                        Visibility="{x:Bind ViewModel.IsEditing, Mode=OneWay, Converter={StaticResource FalseToVisibleConverter}}"
                        Command="{x:Bind ViewModel.EnableEditingCommand}">

                    <SymbolIcon Symbol="Edit" />
                </Button>

                <Button Background="Transparent"
                        BorderBrush="Transparent"
                        BorderThickness="0"
                        Padding="12"
                        VerticalAlignment="Top"
                        Visibility="{x:Bind ViewModel.IsEditing, Mode=OneWay, Converter={StaticResource FalseToVisibleConverter}}"
                        Command="{x:Bind ViewModel.EnableEditingCommand}">

                    <SymbolIcon Symbol="More"
                                RenderTransformOrigin=".5,.5">
                        <SymbolIcon.RenderTransform>
                            <RotateTransform Angle="90" />
                        </SymbolIcon.RenderTransform>
                    </SymbolIcon>
                </Button>
            </StackPanel>

        </local:PageShell.ActionBar>

        <local:PageShell.ContentView>

            <UserControl>
                <Grid>
                    <VisualStateManager.VisualStateGroups>
                        <!--AdaptiveTriggers-->
                        <VisualStateGroup>
                            <VisualState>
                                <VisualState.StateTriggers>
                                    <AdaptiveTrigger MinWindowWidth="0" />
                                </VisualState.StateTriggers>

                                <VisualState.Setters>
                                    <Setter Target="desktopHeader.Visibility"
                                            Value="Collapsed" />
                                </VisualState.Setters>
                            </VisualState>

                            <VisualState>
                                <VisualState.StateTriggers>
                                    <AdaptiveTrigger MinWindowWidth="640" />
                                </VisualState.StateTriggers>
                            </VisualState>
                        </VisualStateGroup>

                    </VisualStateManager.VisualStateGroups>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Grid x:Name="desktopHeader"
                          Visibility="Visible"
                          Padding="12,12,12,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Text="{x:Bind ViewModel.ItemName, Mode=OneWay}"
                                   Style="{StaticResource TitleTextBlockStyle}"
                                   Grid.Row="1" />

                        <StackPanel Orientation="Horizontal"
                                    Spacing="8"
                                    Grid.Column="1">
                            <Button Visibility="{x:Bind ViewModel.IsEditing, Mode=OneWay, Converter={StaticResource FalseToVisibleConverter}}"
                                    Command="{Binding EnableEditingCommand}"
                                    Padding="14, 10">
                                <FontIcon Glyph="&#xE70F;"
                                          FontSize="14" />
                            </Button>

                            <Button Visibility="{x:Bind ViewModel.IsEditing, Mode=OneWay, Converter={StaticResource FalseToVisibleConverter}}"
                                    Command="{x:Bind ViewModel.DeleteCommand}"
                                    Padding="14, 10">
                                <FontIcon Glyph="&#xE74D;"
                                          FontSize="14" />
                            </Button>

                            <Button Command="{x:Bind ViewModel.CloseCommand}"
                                    Padding="14, 10">
                                <FontIcon Glyph="&#xE8BB;"
                                          FontSize="14" />
                            </Button>
                        </StackPanel>
                    </Grid>

                    <ScrollViewer Visibility="{x:Bind ViewModel.IsEditing, Mode=OneWay, Converter={StaticResource FalseToVisibleConverter}}"
                                  Grid.Row="1">
                        <StackPanel Spacing="8"
                                    Style="{StaticResource ContentStack}">

                            <local:DetailsBox Title="for the price of">
                                <local:DetailsBox.ContentView>
                                    <TextBlock TextWrapping="WrapWholeWords">
                                     <Run Text="{x:Bind ViewModel.SelectedItem.Item.Billing.BasePrice, Mode=OneWay}" />
                                     <Run Text="{x:Bind ViewModel.SelectedItem.Item.Billing.CurrencyId, Mode=OneWay}" />
                                    </TextBlock>
                                </local:DetailsBox.ContentView>
                            </local:DetailsBox>

                            <local:DetailsBox Title="paid in total">
                                <local:DetailsBox.ContentView>
                                    <TextBlock TextWrapping="WrapWholeWords">
                                       <Run Text="N/A" />
                                       <Run Text="{x:Bind ViewModel.SelectedItem.Item.Billing.CurrencyId, Mode=OneWay}" />
                                    </TextBlock>
                                </local:DetailsBox.ContentView>
                            </local:DetailsBox>

                            <local:DetailsBox Title="billing period"
                                              Text="{x:Bind ViewModel.SelectedItem.Item.Billing.PeriodType, Mode=OneWay}" />

                            <local:DetailsBox Title="payment method"
                                              Text="N/A" />

                            <local:DetailsBox Title="next payments">
                                <local:DetailsBox.ContentView>
                                    <ScrollViewer HorizontalScrollMode="Auto"
                                                  HorizontalScrollBarVisibility="Auto"
                                                  Margin="-16"
                                                  Padding="16">
                                        <ItemsRepeater VerticalAlignment="Top"
                                                       ItemsSource="{x:Bind ViewModel.FuturePayments, Mode=OneWay}">
                                            <ItemsRepeater.Layout>
                                                <StackLayout Orientation="Horizontal"
                                                             Spacing="8" />
                                            </ItemsRepeater.Layout>
                                        </ItemsRepeater>
                                    </ScrollViewer>
                                </local:DetailsBox.ContentView>
                            </local:DetailsBox>

                            <local:DetailsBox Title="paying since"
                                              Text="{x:Bind ViewModel.SelectedItem.Item.Billing.InitialDate, Mode=OneWay}" />

                            <local:DetailsBox Title="other">
                                <!--<local:DetailsBox.ContentView>
                                    <StackPanel Orientation="Horizontal"
                                                Spacing="12">
                                        <FontIcon Glyph="&#xE719;" />
                                        <FontIcon Glyph="&#xE720;" />
                                    </StackPanel>
                                </local:DetailsBox.ContentView>-->
                            </local:DetailsBox>

                            <local:DetailsBox Title="description"
                                              Text="{x:Bind ViewModel.SelectedItem.Item.Description, Mode=OneWay}" />
                            <!--Visibility="{Binding SelectedItem.Item.Description, Mode=OneWay, Converter={StaticResource StringVisibilityConverter}, ConverterParameter=False}"-->

                        </StackPanel>
                    </ScrollViewer>

                    <Grid Visibility="{x:Bind ViewModel.IsEditing, Mode=TwoWay, Converter={StaticResource TrueToVisibleConverter}}"
                          RowSpacing="12"
                          Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <ScrollViewer>
                            <StackPanel Spacing="16"
                                        Style="{StaticResource ContentStack}">

                                <TextBox Header="Name"
                                         Text="{Binding SelectedItem.Item.Name, Mode=TwoWay}" />

                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <NumberBox Header="Price"
                                               Value="{Binding SelectedItem.Item.Billing.BasePrice, Mode=TwoWay, Converter={StaticResource DecimalToDoubleConverter}}"
                                               SpinButtonPlacementMode="Inline" />
                                    <ComboBox VerticalAlignment="Bottom"
                                              ItemsSource="{x:Bind ViewModel.Currencies, Mode=OneWay}"
                                              SelectedItem="{Binding SelectedItem.Item.Billing.CurrencyId, Mode=TwoWay}"
                                              Grid.Column="1" />
                                </Grid>

                                <!--TODO Make the Tags more safe for future versions, check for inner TagId-->
                                <ComboBox Header="Tag"
                                          ItemsSource="{x:Bind ViewModel.Tags, Mode=OneTime}"
                                          SelectedIndex="{Binding SelectedItem.Item.TagId, Mode=TwoWay}"
                                          VerticalAlignment="Bottom">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate x:DataType="models:Tag">
                                            <StackPanel Orientation="Horizontal"
                                                        Spacing="12">
                                                <Rectangle Fill="{Binding Color, Converter={StaticResource ColorToBrushConverter}}"
                                                           Width="16"
                                                           Height="16"
                                                           RadiusX="4"
                                                           RadiusY="4" />
                                                <TextBlock Text="{Binding Name}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <CalendarDatePicker Header="Billing Date"
                                                    Date="{Binding SelectedItem.Item.Billing.InitialDate, Mode=TwoWay, Converter={StaticResource DateOnlyToDateTimeOffsetConverter}}"
                                                    HorizontalAlignment="Stretch" />

                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <NumberBox Header="Repete every"
                                               Value="{Binding SelectedItem.Item.Billing.RecurEvery, Mode=TwoWay}"
                                               SpinButtonPlacementMode="Inline" />
                                    <ComboBox VerticalAlignment="Bottom"
                                              ItemsSource="{toolkit:EnumValues Type=models:Period}"
                                              SelectedItem="{Binding SelectedItem.Item.Billing.PeriodType, Mode=TwoWay}"
                                              Grid.Column="1" />
                                </Grid>

                                <Grid>
                                    <!--TODO Add changing icon here-->
                                    <CheckBox Content="Get notified {NI}"
                                              IsEnabled="True" />
                                    <FontIcon HorizontalAlignment="Right"
                                              Opacity="0.75"
                                              FontSize="18"
                                              Glyph="&#xEA8F;" />
                                </Grid>

                                <Grid>
                                    <CheckBox Content="Split between people {NI}" />
                                    <FontIcon HorizontalAlignment="Right"
                                              Opacity="0.7"
                                              FontSize="18"
                                              Glyph="&#xE748;" />
                                </Grid>
                                <TextBox Header="Description"
                                         Text="{Binding SelectedItem.Item.Description, Mode=TwoWay}"
                                         Height="120"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True" />
                            </StackPanel>
                        </ScrollViewer>

                        <Button Content="{x:Bind ViewModel.SaveText, Mode=OneWay}"
                                Command="{x:Bind ViewModel.SaveCommand}"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                Height="42"
                                Margin="12"
                                Grid.Row="1" />

                    </Grid>
                </Grid>
            </UserControl>

        </local:PageShell.ContentView>
    </local:PageShell>
</Page>

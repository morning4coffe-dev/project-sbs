<Page x:Class="ProjectSBS.Presentation.Components.ItemDetails"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:ProjectSBS.Presentation.Components"
      xmlns:models="using:ProjectSBS.Business.Models"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:comp="using:ProjectSBS.Presentation.Components"
      mc:Ignorable="d">

    <Page.Resources>
        <Style x:Key="DetailsBorder"
               TargetType="Border">
            <Setter Property="CornerRadius"
                    Value="4" />
            <Setter Property="Background"
                    Value="{ThemeResource CardBackgroundFillColorDefault}" />
            <Setter Property="Padding"
                    Value="16" />
        </Style>
    </Page.Resources>

    <comp:PageShell MobileTitleVisibility="Visible">
        <comp:PageShell.ContentView>

            <UserControl>
                <Grid>

                    <ScrollViewer Visibility="{Binding IsEditing, Mode=OneWay, Converter={StaticResource FalseToVisibleConverter}}">
                        <StackPanel Spacing="8"
                                    Margin="8">
                            <Border Style="{StaticResource DetailsBorder}">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="{Binding SelectedItem.Item.Name, Mode=OneWay}"
                                               Style="{StaticResource SubtitleTextBlockStyle}"
                                               TextWrapping="WrapWholeWords" />
                                    <TextBlock TextWrapping="WrapWholeWords">
                                    <Run Text="{Binding SelectedItem.Item.Billing.BasePrice, Mode=OneWay}" />
                                    <Run Text="{Binding SelectedItem.Item.Billing.CurrencyId, Mode=OneWay}" />
                                    </TextBlock>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource DetailsBorder}">
                                <TextBlock Text="{Binding SelectedItem.Item.Description, Mode=OneWay}"
                                           TextWrapping="WrapWholeWords" />
                            </Border>

                            <Border Style="{StaticResource DetailsBorder}">
                                <ScrollViewer HorizontalScrollMode="Auto"
                                              HorizontalScrollBarVisibility="Auto"
                                              Margin="-16"
                                              Padding="16">
                                    <ItemsRepeater VerticalAlignment="Top"
                                                   ItemsSource="{x:Bind ViewModel.Items}">
                                        <ItemsRepeater.Layout>
                                            <StackLayout Orientation="Horizontal"
                                                         Spacing="8" />
                                        </ItemsRepeater.Layout>

                                        <ItemsRepeater.ItemTemplate>
                                            <DataTemplate x:DataType="local:ItemViewModel">
                                                <Grid Height="100"
                                                      Width="140"
                                                      CornerRadius="4"
                                                      Background="Blue">
                                                    <TextBlock Text="{x:Bind Item.Name}"
                                                               Padding="8" />
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsRepeater.ItemTemplate>
                                    </ItemsRepeater>
                                </ScrollViewer>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>

                    <Grid Visibility="{Binding IsEditing, Mode=TwoWay, Converter={StaticResource TrueToVisibleConverter}}"
                          RowSpacing="12">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="auto" />
                        </Grid.RowDefinitions>

                        <ScrollViewer>
                            <StackPanel Spacing="16"
                                        Margin="8">
                                <TextBox Header="Name"
                                         Text="{Binding SelectedItem.Item.Name, Mode=TwoWay}" />

                                <Grid ColumnSpacing="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="auto" />
                                    </Grid.ColumnDefinitions>

                                    <NumberBox Header="Price"
                                               Value="{Binding SelectedItem.Item.Billing.BasePrice, Mode=TwoWay, Converter={StaticResource DecimalToDoubleConverter}}"
                                               SpinButtonPlacementMode="Inline" />
                                    <ComboBox VerticalAlignment="Bottom"
                                              ItemsSource="{x:Bind ViewModel.Currencies, Mode=OneWay}"
                                              SelectedItem="{x:Bind}"
                                              Grid.Column="1" />
                                </Grid>

                                <!--TODO Make the Tags more safe for future versions, check for inner TagId-->
                                <ComboBox Header="Tag"
                                          ItemsSource="{x:Bind ViewModel.Tags, Mode=OneTime}"
                                          SelectedIndex="{Binding SelectedItem.Item.TagId, Mode=TwoWay}"
                                          VerticalAlignment="Bottom">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate x:DataType="models:Tag">
                                            <StackPanel Orientation="Horizontal"
                                                        Spacing="12">
                                                <Rectangle Fill="{Binding Color, Converter={StaticResource ColorToBrushConverter}}"
                                                           Width="16"
                                                           Height="16"
                                                           RadiusX="4"
                                                           RadiusY="4" />
                                                <TextBlock Text="{Binding Name}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <CalendarDatePicker Header="Billing Date"
                                                    Date="{Binding SelectedItem.Item.Billing.InitialDate, Mode=TwoWay, Converter={StaticResource DateOnlyToDateTimeOffsetConverter}}"
                                                    HorizontalAlignment="Stretch" />
                                <Grid>
                                    <CheckBox Content="Notifications {NI}" />
                                    <FontIcon HorizontalAlignment="Right"
                                              Opacity="0.7"
                                              FontSize="18"
                                              Glyph="" />
                                </Grid>

                                <Grid>
                                    <CheckBox Content="Split between people {NI}" />
                                    <FontIcon HorizontalAlignment="Right"
                                              Opacity="0.7"
                                              FontSize="18"
                                              Glyph="" />
                                </Grid>
                                <TextBox Header="Description"
                                         Text="{Binding SelectedItem.Item.Description, Mode=TwoWay}"
                                         Height="120"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True" />
                            </StackPanel>
                        </ScrollViewer>

                        <Button Content="{x:Bind ViewModel.SaveText, Mode=OneWay}"
                                Command="{x:Bind ViewModel.SaveCommand}"
                                HorizontalAlignment="Stretch"
                                Height="45"
                                Grid.Row="1" />

                    </Grid>
                </Grid>
            </UserControl>

        </comp:PageShell.ContentView>
    </comp:PageShell>
</Page>
